# Security posture for gaxx

Gaxx is designed with secure-by-default assumptions for distributed remote execution. This document explains the defaults, the security model, and how to harden deployments.

## Defaults (as implemented)

- SSH key-only authentication; strong Ed25519 keys generated by `gaxx init`
- SSH daemon hardened: `PermitRootLogin no`, `PasswordAuthentication no`
- Non-root user `gx` used for agent operations by default
- Strict `known_hosts` management for SSH host key pinning
- Sensible timeouts, retries, and backoff for remote operations
- Telemetry and monitoring are available and off/limited by default in CLI; the agent exposes monitoring and pprof endpoints when running

## Components and network surface

- CLI (`gaxx`)
  - Optional monitoring server (default when enabled): `:9090`
  - Intended to run locally on developer or orchestrator machine

- Agent (`gaxx-agent`)
  - API: `:8088`
    - `POST /v0/exec` — execute a command on the node
    - `GET  /v0/heartbeat` — health/identity response
  - Monitoring: `:9091` (health, metrics, dashboard)
  - Profiling (pprof + runtime stats): `:6060`

Important: Agent API and monitoring endpoints are not authenticated by default. Production deployments must restrict network access (see Hardening checklist).

## SSH hardening

- Keys are created by `gaxx init` under `~/.config/gaxx/ssh/`
- Use per-fleet ephemeral keys; rotate on fleet deletion
- Enforce strict host key checking with the managed `known_hosts`
- Restrict SSH from the orchestrator IP(s) only (cloud firewall / security groups)

## Secrets management

- Configuration lives in `~/.config/gaxx/`
  - `config.yaml` — providers, defaults, telemetry
  - `secrets.env` — tokens and credentials (create with mode `0600`)
- Preferred: inject secrets via environment variables or OS keychain
- Do not commit secrets to source control

## Telemetry and monitoring

- Telemetry can be enabled in `config.yaml`:
  - `telemetry.enabled: true|false`
  - `telemetry.otlp_endpoint: <url>` (if exporting)
  - `telemetry.monitoring_port: 9090` (CLI monitoring)
  - `telemetry.metrics_interval: <seconds>` (collection/flush cadence)
- Agent monitoring endpoints:
  - Health JSON: `http://<node>:9091/health`
  - Prometheus metrics: `http://<node>:9091/metrics`
  - Dashboard: `http://<node>:9091/dashboard`
- Profiling endpoints (agent): `http://<node>:6060/debug/pprof/*` and `.../debug/stats`
- Guidance:
  - Keep monitoring and profiling ports bound to private interfaces or protected networks
  - If exporting metrics, use TLS for OTLP endpoints and avoid sending sensitive labels

## Provider credentials

- Cloud provider tokens (Linode, Vultr) should be stored in `secrets.env` with file mode `0600`, or provided via environment variables at runtime
- Scope tokens minimally and rotate regularly
- Apply cloud-side firewall rules (security groups) to restrict:
  - SSH (22/tcp) to orchestrator IPs
  - Agent API (8088/tcp), Monitoring (9091/tcp), Profiling (6060/tcp) to private networks or trusted IPs only

## Logging and data handling

- CLI and agent produce structured JSON logs
- Command outputs may contain sensitive data; avoid echoing secrets in commands/env
- Consider central log collection with access controls and retention limits

## Supply chain and builds

- Build from source with a recent Go toolchain; verify `go.sum` and use pinned dependencies
- Prefer reproducible builds (`CGO_ENABLED=0`) as provided by the Makefile
- When using binaries, verify checksums and signatures (planned for releases)

## Hardening checklist (production)

1. Network
   - Restrict SSH (22/tcp) to orchestrator IPs
   - Restrict agent API (8088/tcp), monitoring (9091/tcp), and profiling (6060/tcp) to private networks or VPN only
   - Place nodes inside a VPC/VNet; avoid public IPs where possible

2. Agent
   - Run as non-root user `gx`; avoid shelling out with elevated privileges
   - Disable or firewall pprof (6060) unless actively profiling
   - Monitor agent health via `/v0/heartbeat` and `/health`

3. Credentials
   - Store provider tokens in environment variables or `secrets.env` (0600)
   - Rotate tokens regularly; scope with least privilege

4. SSH
   - Use per-fleet keys; rotate on fleet destruction
   - Enforce strict host key checking and maintain `known_hosts`

5. Telemetry
   - If exporting to OTLP, use TLS; avoid sensitive labels/values
   - Limit access to metrics endpoints; prefer pull from private networks

6. Logging
   - Redact secrets from logs and command outputs
   - Control retention and access

## Reporting a vulnerability

Please use GitHub Security Advisories to privately report vulnerabilities to `github.com/3cpo-dev/gaxx`. Provide a minimal, reproducible description and the affected versions/commit.

I aim to respond promptly with assessment, mitigation guidance, and patch timelines.

